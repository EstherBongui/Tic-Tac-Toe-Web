<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="jeu.css">
    <title>Partie</title>
</head>
<body>
  <div class="container">
    <div class="card">
        <h5 class="card-header">Partie En Cours</h5>
        <div class="card-body">
          <form action="InfoJoueur.html" method="post">
            <div id="plateau_jeu"></div>
            <div id="message"></div><br>

            <input type="submit" value="Abandonner">
          </form>
        </div>
      </div>
  </div>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
            var difficulte = localStorage.getItem('difficulte');
            var symbole = localStorage.getItem('symbole')
            var plateauJeu = document.getElementById('plateau_jeu');
            var tourJoueur;
            var partieTerminee = false;
            var message = document.getElementById('message');
            var table; 

            if (difficulte === 'Facile') {
                genererPlateau(3);
            } else if (difficulte === 'Moyen') {
                genererPlateau(4);
            } else if (difficulte === 'Difficile') {
                genererPlateau(5);
            }

            function genererPlateau(taille) {
                table = document.createElement('table');
                
                for (var i = 0; i < taille; i++) {
                    var row = table.insertRow();
                    for (var j = 0; j < taille; j++) {
                        var cell = row.insertCell();
                        cell.textContent = '';
                        cell.classList.add('cellule');
                    }
                }

                plateauJeu.appendChild(table);
            }

            var cellules = document.querySelectorAll('.cellule');
            cellules.forEach(function(cell, index) {
            cell.addEventListener('click', function () {
                jouerCoup(index);
              });
            });
        
             if(symbole==='X'){
                tourJoueur='X';
               }else if(symbole==='O'){
                tourJoueur='O';
             }
    
            function jouerCoup(index) {
              if (!partieTerminee && !cellules[index].textContent.trim()) {
                cellules[index].innerText = tourJoueur;

            if (verifierGagnant()) {
                partieTerminee = true;
            } else {
                tourJoueur = (tourJoueur === 'X') ? 'O' : 'X'; 
            }
            message.textContent = "C'est le tour du joueur : " + tourJoueur;
            verifierMatchNul();
          }
        }

            function verifierGagnant() {
              for (var i = 0; i < table.rows.length; i++) {
               var ligne = table.rows[i];
               var signesLigne = Array.from(ligne.cells).map(cell => cell.textContent.trim());
              if (signesLigne.every(signe => signe === symbole) || signesLigne.every(signe => signe === (symbole === 'X' ? 'O' : 'X'))) {
                allerResultats();
                return true;
              }
            }

              for (var j = 0; j < table.rows[0].cells.length; j++) {
               var colonne = Array.from(table.rows).map(row => row.cells[j].textContent.trim());
              if (colonne.every(signe => signe === symbole) || colonne.every(signe => signe === (symbole === 'X' ? 'O' : 'X'))) {
                allerResultats();
                return true;
              }
            }

               var diagonale1 = Array.from(table.rows).map((row, index) => row.cells[index].textContent.trim());
               var diagonale2 = Array.from(table.rows).map((row, index) => row.cells[table.rows.length - 1 - index].textContent.trim());

              if (diagonale1.every(signe => signe === symbole) || diagonale1.every(signe => signe === (symbole === 'X' ? 'O' : 'X')) || diagonale2.every(signe => signe === symbole) || diagonale2.every(signe => signe === (symbole === 'X' ? 'O' : 'X'))) {
               allerResultats();
               return true;
            }
                return false; 
            }

            function verifierMatchNul() {
              var toutesLesCellulesRemplies = true;

              for (let i = 0; i < table.rows.length; i++) {
                for (let j = 0; j < table.rows[i].cells.length; j++) {
                  if (table.rows[i].cells[j].textContent.trim() === '') {
                    toutesLesCellulesRemplies = false;
                    break;
                    }
                  }
                  if (!toutesLesCellulesRemplies) {
                    break;
                  }
               }

                  if (toutesLesCellulesRemplies && !verifierGagnant()) {
                   allerResultats();
                 }
                
                }

            function allerResultats(){
              window.location.href="Resultats.html";
            }
          
          });
      </script>   
</body>
</html>